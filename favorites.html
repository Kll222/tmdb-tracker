<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>我的收藏</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
/* 与主页面样式保持一致 */
body{font-family:Arial;background:#f5f5f5;margin:0;padding:0;}
header{background:#333;color:white;padding:15px;text-align:center;}
h1{margin:0;}
header a{color:white;text-decoration:none;margin-left:20px;}
#movie-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:15px;padding:10px;}
.card{background:white;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.2);overflow:hidden;text-align:center;cursor:pointer;transition: transform 0.2s;}
.card:hover{transform:scale(1.05);}
.card img{width:100%;height:auto;}
.card h2{font-size:16px;margin:5px 0;}
.card p{font-size:12px;color:#555;margin:0 0 5px;}
.card button{margin-bottom:5px;}
#modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);justify-content:center;align-items:center;}
#modal-content{background:white;padding:20px;border-radius:8px;max-width:500px;width:90%;text-align:center;position:relative;}
#modal-content img{width:200px;border-radius:6px;}
#modal-content h2{margin:15px 0 10px;}
#modal-content p{margin:5px 0;color:#444;}
#close-btn{position:absolute;top:10px;right:15px;font-size:20px;cursor:pointer;color:#333;}
#modal-fav-btn{margin-top:10px;padding:5px 10px;background:#333;color:white;border:none;border-radius:4px;cursor:pointer;}
#pagination {
  width: 100%;
  text-align: center;
  margin: 20px 0;
}
</style>
</head>
<body>
<header>
<h1>❤️ 我的收藏</h1>
<a href="index.html">返回首页</a>
</header>

<section id="movie-list"></section>

<!-- Modal -->
<div id="modal">
  <div id="modal-content">
    <span id="close-btn">&times;</span>
    <img id="modal-poster" src="" alt="海报">
    <h2 id="modal-title"></h2>
    <p id="modal-date"></p>
    <p id="modal-region"></p>
    <p id="modal-genres"></p>
    <p id="modal-overview"></p>
    <button id="modal-fav-btn">❤️ 取消收藏</button>
  </div>
</div>

<script>
let movies = [];
let currentPage = 1;
const perPage = 12;

function getFavorites(){ const fav = localStorage.getItem('favorites'); return fav?JSON.parse(fav):[]; }
function saveFavorites(favs){ localStorage.setItem('favorites',JSON.stringify(favs)); }
function getSortedFavorites() {
  return getFavorites()
    .map(f => ({
      ...f,
      fav_time: f.fav_time || 0
    }))
    .sort((a, b) => b.fav_time - a.fav_time);
}
function isFavorite(id){ return getFavorites().some(f=>f.id===id); }
function toggleFavorite(movie){ 
  let favs=getFavorites()
    .map(f => ({
      ...f,
      fav_time: f.fav_time || 0
    })); 
  if(isFavorite(movie.id)){ favs=favs.filter(f=>f.id!==movie.id); } 
  else{
  favs.push({
    ...movie,
    fav_time: Date.now()
  });
 } 
  saveFavorites(favs); 
  movies=getSortedFavorites(); 
  currentPage= 1;
  renderMovies();
}

function renderMovies(){
  const movieList=document.getElementById('movie-list');
  movieList.innerHTML="";
  const start=(currentPage-1)*perPage; const end=start+perPage;
  const pageMovies=movies.slice(start,end);
  pageMovies.forEach(movie=>{
    const card=document.createElement('div'); card.className='card';
    card.innerHTML=`<img src="${movie.poster_url}" alt="海报"><h2>${movie.title}</h2><p>${movie.region}</p><button class="fav-btn">❤️ 取消收藏</button>`;
    card.onclick=()=>showModal(movie);
    card.querySelector('.fav-btn').onclick=e=>{ e.stopPropagation(); toggleFavorite(movie); };
    movieList.appendChild(card);
  });
  renderPagination();
}

function renderPagination(){
  const pagination=document.createElement('div'); const pageDiv=document.getElementById('pagination')||document.createElement('div'); pageDiv.id='pagination'; document.body.appendChild(pageDiv);
  pageDiv.innerHTML="";
  const totalPages=Math.ceil(movies.length/perPage);
  const prevBtn=document.createElement('button'); prevBtn.textContent="上一页"; prevBtn.disabled=currentPage===1; prevBtn.onclick=()=>{currentPage--;renderMovies();}; pageDiv.appendChild(prevBtn);
  const nextBtn=document.createElement('button'); nextBtn.textContent="下一页"; nextBtn.disabled=currentPage===totalPages; nextBtn.onclick=()=>{currentPage++;renderMovies();}; pageDiv.appendChild(nextBtn);
}

function showModal(movie){
  document.getElementById('modal-poster').src=movie.poster_url;
  document.getElementById('modal-title').textContent=movie.title;
  document.getElementById('modal-date').textContent="上映日期："+movie.release_date;
  document.getElementById('modal-region').textContent="地区："+movie.region;
  document.getElementById('modal-genres').textContent="类型："+movie.genres;
  document.getElementById('modal-overview').textContent="简介："+movie.overview;
  const favBtn=document.getElementById('modal-fav-btn');
  favBtn.textContent="❤️ 取消收藏";
  favBtn.onclick=()=>{ toggleFavorite(movie); favBtn.textContent="❤️ 取消收藏"; };
  document.getElementById('modal').style.display="flex";
}

document.getElementById('close-btn').onclick=()=>document.getElementById('modal').style.display="none";
window.onclick=(e)=>{ if(e.target.id==="modal"){ document.getElementById('modal').style.display="none"; } }

movies = getSortedFavorites();
currentPage = 1;
renderMovies();
</script>
</body>
</html>